<!DOCTYPE html>
<html>

<head>
  <title>Robot Control</title>
  <link rel="stylesheet" href="style.css">
  </link>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script> -->
  <script src="script.js"></script>
</head>

<body>
  <div class="main-container">
    <div class="navigation-container">
      <div class="flex-container">
        <!-- Clicking this div calls robotMove(1) -->
        <div class="forward" onclick="robotMove(1)">&#8593;</div>
      </div>
      <div class="flex-container">
        <!-- Clicking this div calls robotMove(2) -->
        <div class="left" onclick="robotMove(2)">&#8592;</div>
        <!-- Clicking this div calls robotMove(5) -->
        <div class="stop" onclick="robotMove(5)">&#x25A0</div>
        <!-- Clicking this div calls robotMove(3) -->
        <div class="right" onclick="robotMove(3)">&#8594;</div>
      </div>
      <div class="flex-container">
        <!-- Clicking this div calls robotMove(4) -->
        <div class="backward" onclick="robotMove(4)">&#8595;</div>
      </div>
      <div class="flex-container">
        <!-- New container with the "automatic" class -->
        <div class="automatic" onclick="robotMove(6)">Automatic</div>
      </div>
      <div class="flex-container">
        <div class="off">Off</div>
        <div class="analyze">Analyze</div>
      </div>
    </div>
    <div class="image-container">
      <div class="video-container"><img id="video" width="640" height="480"></div>
      <div class="thermal-container"><img id="thermal"></div>
      <div class="temperature-container">
        <div class="temperature-display">Temp: &nbsp; <span id="temperature-value">N/A</span></div>
        <div class="humidity-display">Humidity: &nbsp; <span id="humidity-value">N/A</span></div>
      </div>
      <audio id="audio" controls>
        <source id="audioSource" src="recording.wav" type="audio/wav">
      </audio>
      <button id="record" onclick="makeGetRequest()">Listen</button>
      <div id="audio-response"></div>
    </div>
  </div>

  <script>
    var ws = new WebSocket('ws://' + location.hostname + ':8081/video_feed_thread');
    ws.onmessage = function (event) {
      var data = JSON.parse(event.data);
      document.getElementById('video').src = 'data:image/jpeg;base64,' + data.image;
    };
  </script>

  <script>
    var temp_ws = new WebSocket('ws://' + location.hostname + ':8082/temperature_feed_thread');
    temp_ws.onmessage = function (event) {
      var data = JSON.parse(event.data);
      var temp_humid_values = data.temperature_data.split(",");
      document.getElementById('temperature-value').innerText = temp_humid_values[0] + "Â°C";
      document.getElementById('humidity-value').innerText = temp_humid_values[1] + "%";
    };
  </script>

  <script>
    var thermal_ws = new WebSocket('ws://' + location.hostname + ':8083/thermal_feed_thread');
    thermal_ws.onmessage = function (event) {
      var data = JSON.parse(event.data);
      document.getElementById('thermal').src = 'data:image/jpeg;base64,' + data.thermal_image;
    };
  </script>

  <script>
      function makeGetRequest() {
        console.log('pushed')
        document.getElementById('audio-response').innerHTML = 'Listening...';
        fetch('http://' + location.hostname + ':8084/audio_feed_thread')
          .then(response => response.text())
          .then(data => {
            console.log(data)
            if (data) {
              document.getElementById('audio-response').innerHTML = 'Speech Detected';
              document.getElementById('audio-response').classList.add('speech');
              document.getElementById('audio-response').classList.remove('no-speech');
            } else {
              document.getElementById('audio-response').innerHTML = 'No Speech Detected';
              document.getElementById('audio-response').classList.add('no-speech');
              document.getElementById('audio-response').classList.remove('speech');
            }
            setTimeout(() => {
              document.getElementById('audio-response').innerHTML = '';
              document.getElementById('audio-response').classList.remove('speech');
              document.getElementById('audio-response').classList.remove('no-speech');
            }, 5000);
          })
          .catch(error => console.error(error));
      }

  </script>


  <!-- This is the script file with all the javascript -->
  <script src="script.js"></script>
</body>

</html>